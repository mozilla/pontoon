import { createReduxStore, mountComponentWithStore } from '~/test/store';

import { ResourceProgress } from './ResourceProgress';
import { vi } from 'vitest';
import { fireEvent } from '@testing-library/react';

describe('<ResourceProgress>', () => {
  const STATS = {
    approved: 5,
    pretranslated: 4,
    unreviewed: 5,
    warnings: 3,
    errors: 2,
    missing: 1,
    total: 15,
  };
  const PARAMETERS = {
    entity: 0,
    locale: 'en-GB',
    project: 'tutorial',
    resource: 'all-resources',
    status: 'errors',
    search: null,
  };

  beforeAll(() => {
    HTMLCanvasElement.prototype.getContext = vi.fn();
  });

  it('shows only a selector by default', () => {
    const store = createReduxStore({ stats: STATS });
    const { getByRole, queryByRole } = mountComponentWithStore(
      ResourceProgress,
      store,
      {
        parameters: PARAMETERS,
      },
    );

    getByRole('button');
    expect(queryByRole('complementary')).not.toBeInTheDocument();
  });

  it('shows the info menu after a click', () => {
    const store = createReduxStore({ stats: STATS });
    const { getByRole } = mountComponentWithStore(ResourceProgress, store, {
      parameters: PARAMETERS,
    });
    fireEvent.click(getByRole('button'));

    getByRole('complementary');
  });
});
